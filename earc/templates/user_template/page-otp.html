<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- bootstrap 5 stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.1/css/bootstrap.min.css" integrity="sha512-Ez0cGzNzHR1tYAv56860NLspgUGuQw16GiOOp/I2LuTmpSK9xDXlgJz3XN4cnpXWDmkNBKXR/VDMTCnAaEooxA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- fontawesome 6 stylesheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>VERIFICATION</title>
    <style>
        .height-100 {
    height: 100vh
}

.card {
    width: 400px;
    border: none;
    height: 300px;
    box-shadow: 0px 5px 20px 0px #d2dae3;
    z-index: 1;
    display: flex;
    justify-content: center;
    align-items: center
}
    </style>
</head>
<body>

    <div class="container height-100 d-flex flex-column justify-content-center align-items-center">
        <div>
            {% if messages %}
            {% for message in messages %}
            <p id="error" class="text-danger fw-semibold fs-6">{{ message }}</p>
            {% endfor %}
            {% endif %}
            <p id="error" class="text-danger fw-semibold fs-6"> </p>
        </div>
        <div class="position-relative">
            <div class="card p-2 text-center">
                <h6>Please enter the one time password <br> to verify your account</h6>
                <div> <span>A code has been sent to</span> <small style="font-weight: bold; font-size: 13px;">{{ email }}</small> </div>
                <form action="" method="post">
                    {% csrf_token %}
                    <div id="otp" class="inputs d-flex flex-row justify-content-center mt-2"> 
                        <input class="m-2 text-center form-control rounded" name="otp_one" type="text" id="first" maxlength="1" /> 
                        <input class="m-2 text-center form-control rounded" name="otp_two" type="text" id="second" maxlength="1" /> 
                        <input class="m-2 text-center form-control rounded" name="otp_three" type="text" id="third" maxlength="1" /> 
                        <input class="m-2 text-center form-control rounded" name="otp_four" type="text" id="fourth" maxlength="1" /> 
                        <input class="m-2 text-center form-control rounded" name="otp_five" type="text" id="fifth" maxlength="1" /> 
                        <input class="m-2 text-center form-control rounded" name="otp_six" type="text" id="sixth" maxlength="1" /> 
                    </div>
                    <div class="px-2 d-flex flex-row justify-content-start mt-2">
                        <p id="countdown" style="font-size: 13px; font-weight: bold; color: rgb(83, 83, 83);">00:00</p>
                        {% if status == 'forgot_otp' %}
                        <a id="resentButton" href="{% url 'user_app:sent_forget_password_otp' %}" class="btn-secondary btn btn-sm" style="display: none;">Resent OTP</a>
                        {% else %}
                        <a id="resentButton" href="{% url 'user_app:otp_resent' %}?email={{email}}" class="btn-secondary btn btn-sm" style="display: none;">Resent</a>
                        {% endif %}
                    </div>
                    <div class="mt-4"> <button type="submit" class="btn btn-danger px-4 validate">Validate</button> </div>
                </form>  
            </div>
        </div>
    </div>


    <script>

        // Set the expiration time in seconds
       // Assuming you have the remaining_minutes and remaining_seconds variables defined somewhere in your Django template
var remainingMinutes = {{ remaining_minutes }};
var remainingSeconds = {{ remaining_seconds }};

// Calculate the total remaining time in seconds
var remainingTime = remainingMinutes * 60 + remainingSeconds;

// Update the countdown every second
var countdown = setInterval(function () {
    // Calculate minutes and seconds
    var minutes = Math.floor(remainingTime / 60);
    var seconds = remainingTime % 60;

    // Display leading zero if seconds are less than 10
    seconds = seconds < 10 ? '0' + seconds : seconds;

    // Display the countdown
    document.getElementById("countdown").innerHTML = minutes + ":" + seconds;

    // Decrease the remaining time
    remainingTime--;

    // If the countdown reaches zero, clear the interval
    if (remainingTime < 0) {
        clearInterval(countdown);
        document.getElementById('resentButton').style.display = 'block';
        document.getElementById("countdown").style.display = 'none'
        document.getElementById('error').innerHTML = 'OTP has expired. Request new one'
    }
}, 1000);



document.addEventListener("DOMContentLoaded", function(event) {

function OTPInput() {
const inputs = document.querySelectorAll('#otp > *[id]');
for (let i = 0;
 i < inputs.length; i++) { inputs[i].addEventListener('keydown', function(event) { if (event.key==="Backspace" ) { inputs[i].value='' ; if (i !==0) inputs[i - 1].focus(); } else { if (i===inputs.length - 1 && inputs[i].value !=='' ) { return true; } else if (event.keyCode> 47 && event.keyCode < 58) { inputs[i].value=event.key; if (i !==inputs.length - 1) inputs[i + 1].focus(); event.preventDefault(); } else if (event.keyCode> 64 && event.keyCode < 91) { inputs[i].value=String.fromCharCode(event.keyCode); if (i !==inputs.length - 1) inputs[i + 1].focus(); event.preventDefault(); } } }); } } OTPInput(); });
</script>
    
</body>
</html>



