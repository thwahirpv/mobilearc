{% extends "base_page.html" %}
{% load static %}

{% block title %}
ADD PRODUCT
{% endblock %}

    

{% block content %}
{% include "admin_sidenav.html"%}

    <main class="main-wrap">
        {% include 'admin_nav.html' %}

        <section class="content-main section-con">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
            <div class="row justify-content-center">
                
                <div class="col-6">
                    <div class="d-flex justify-content-between">
                        <h2 class="fs-5">Add Color Variant</h2>
                        <div>
                            <!-- <button class="btn btn-light rounded font-sm mr-5 text-body hover-up">Save to draft</button> -->
                            <button type="submit" class="btn btn-md rounded font-sm hover-up">Publich</button>
                        </div>
                    </div>
                </div>
            

                <div class="row justify-content-center mt-4">
                    <div class="col-lg-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4>Details</h4>
                            </div>
                            <div class="card-body">
                                {% if messages %}
                                {% for message in messages %}
                                    <p class="text-danger fw-semibold fs-6">{{ message }}</p>
                                {% endfor %}
                                {% endif %}
                                <div class="row gx-2 col-12 mt-3">
                                    <div>
                                        <label for="" class="form-label">Color name</label>
                                        <input type="text" class="form-control" name="color">
                                    </div>
                                </div>
                                <div class="row gx-2 col-12 mt-4">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h4>Media</h4>
                                        </div>
                                        <div class="card-body">
                                            <div class="input-upload row justify-content-center align-items-center" id="image-container">
                                                <div class="" id="image-icon">
                                                    <img src="{% static 'assets2/imgs/theme/upload.svg' %}" id="media" alt="" >
                                                </div>
                                                <input class="form-control" id="image-input" type="file" multiple name="images">
                                            </div>
                                        </div>
                                    </div> 
                                </div>
                            </div> <!-- card end// -->
                            <!-- card end// -->
                        </div>
                    </div>
                        
                </div>
            </div>
        </form>


        <div class="crop-container" id="crop-container">
            <div class="c-box" id="c-box">
                
            </div>
        </div>
        </section> 
    </main>

    <script>
        const imageInput = document.getElementById('image-input')
        const middleDiv = document.getElementById('middle')
        const imageIcon = document.getElementById('image-icon')
        const imageContainer = document.getElementById('image-container')
        const cropContainer = document.getElementById('crop-container')
        const cBox = document.getElementById('c-box')

        imageInput.addEventListener('change', ()=>{
            const url = [];
            const img_data = imageInput.files
            const data_set = Object.entries(img_data);
            imageIcon.style.display = 'None'

            data_set.forEach(([key, value]) => {
                const link = URL.createObjectURL(value)
                url.push(link)

                const imageBox = document.createElement('div')
                imageBox.classList.add('mt-4')
                imageBox.classList.add('col-4')
                imageBox.style.width = 33.33333%
                imageBox.classList.add('position-relative')
                const img = document.createElement('img');
                img.src = link
                img.classList.add('crop-image')
                imageBox.appendChild(img)
                imageContainer.appendChild(imageBox)

                const aTag = document.createElement('a')
                const iTag = document.createElement('i')
                const middleDiv = document.createElement('div')
                iTag.classList.add('fa-solid')
                iTag.classList.add('fa-crop')
                iTag.style.fontSize = '23px'
                aTag.appendChild(iTag)
                middleDiv.classList.add('middle')   
                middleDiv.appendChild(aTag)
                imageBox.appendChild(middleDiv)

                imageBox.addEventListener('mouseover', () => {
                    img.style.opacity = 0.3
                    middleDiv.style.opacity = 1
                })
                imageBox.addEventListener('mouseout', () => {
                    img.style.opacity = 1
                    middleDiv.style.opacity = 0
                })

                iTag.addEventListener('click', () => {
                    cropContainer.style.zIndex = 1
                    cBox.innerHTML = `<img src="${link}" id="image" width="500px"/>`
                    var $image = $('#image');
                    $image.cropper({
                    aspectRatio: 16 / 9,
                    crop: function(event) {
                        console.log(event.detail.x);
                        console.log(event.detail.y);
                        console.log(event.detail.width);
                        console.log(event.detail.height);
                        console.log(event.detail.rotate);
                        console.log(event.detail.scaleX);
                        console.log(event.detail.scaleY);
                    }
                    });

                    // Get the Cropper.js instance after initialized
                    var cropper = $image.data('cropper');

                })
            })

        });
            
    </script>
{% endblock content %}